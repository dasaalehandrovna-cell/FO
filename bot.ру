import telebot
from telebot import types
import json, os, re, datetime, csv

# === ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ===
BOT_TOKEN = "Ð¢ÐžÐšÐ•Ð_Ð¢Ð’ÐžÐ•Ð“Ðž_Ð‘ÐžÐ¢Ð"
OWNER_ID = Ð¢Ð’ÐžÐ™_CHAT_ID_Ð§Ð˜Ð¡Ð›ÐžÐœ  # Ð²ÑÑ‚Ð°Ð²ÑŒ ÑÐ²Ð¾Ð¹ ID
DATA_FILE = "data.json"
CSV_FILE = "records.csv"

bot = telebot.TeleBot(BOT_TOKEN)

# === Ð¡Ð»ÑƒÐ¶ÐµÐ±Ð½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ ===

def log_error(e):
    print("âš ï¸", e)

def default_data():
    return {"chats": {}}

def load_data():
    if os.path.exists(DATA_FILE):
        try:
            with open(DATA_FILE, "r", encoding="utf-8") as f:
                return json.load(f)
        except:
            pass
    return default_data()

def save_data(d):
    with open(DATA_FILE, "w", encoding="utf-8") as f:
        json.dump(d, f, ensure_ascii=False, indent=2)

data = load_data()

def get_today_key():
    return datetime.date.today().strftime("%Y-%m-%d")

def get_chat_store(chat_id):
    if str(chat_id) not in data["chats"]:
        data["chats"][str(chat_id)] = {
            "daily_records": {},
            "balance": 0,
            "edit_wait": None,
            "edit_target": None,
        }
    return data["chats"][str(chat_id)]

def add_record_to_chat(chat_id, amount, note, user_id=None):
    store = get_chat_store(chat_id)
    today = get_today_key()
    if today not in store["daily_records"]:
        store["daily_records"][today] = []
    rid = len(store["daily_records"][today]) + 1
    store["daily_records"][today].append({
        "id": rid,
        "amount": amount,
        "note": note,
        "user_id": user_id
    })
    store["balance"] += amount
    save_data(data)
    return rid

def update_record_in_chat(chat_id, rid, amount, note):
    store = get_chat_store(chat_id)
    today = get_today_key()
    records = store["daily_records"].get(today, [])
    for r in records:
        if r["id"] == rid:
            store["balance"] -= r["amount"]
            r["amount"] = amount
            r["note"] = note
            store["balance"] += amount
            save_data(data)
            return True, r
    return False, None

def delete_record_in_chat(chat_id, rid):
    store = get_chat_store(chat_id)
    today = get_today_key()
    records = store["daily_records"].get(today, [])
    for r in records:
        if r["id"] == rid:
            store["balance"] -= r["amount"]
            records.remove(r)
            save_data(data)
            return True, r
    return False, None

def export_to_csv(data):
    with open(CSV_FILE, "w", newline="", encoding="utf-8") as f:
        writer = csv.writer(f)
        writer.writerow(["Chat ID", "Date", "Record ID", "Amount", "Note"])
        for chat_id, store in data["chats"].items():
            for date, records in store.get("daily_records", {}).items():
                for r in records:
                    writer.writerow([chat_id, date, r["id"], r["amount"], r["note"]])

# === Ð˜Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ ===

def build_main_keyboard(chat_id, confirm_reset=False):
    kb = types.InlineKeyboardMarkup(row_width=3)
    if confirm_reset:
        kb.add(
            types.InlineKeyboardButton("âœ… ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚ÑŒ", callback_data="confirm_reset"),
            types.InlineKeyboardButton("âŒ ÐžÑ‚Ð¼ÐµÐ½Ð°", callback_data="cancel_reset")
        )
        return kb
    kb.add(
        types.InlineKeyboardButton("ðŸ“Š ÐžÑ‚Ñ‡Ñ‘Ñ‚", callback_data="btn_report"),
        types.InlineKeyboardButton("âœï¸ Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ", callback_data="btn_edit"),
        types.InlineKeyboardButton("ðŸ’¾ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚", callback_data="export_csv"),
    )
    kb.add(
        types.InlineKeyboardButton("â™»ï¸ Ð¡Ð±Ñ€Ð¾Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…", callback_data="btn_reset"),
        types.InlineKeyboardButton("ðŸ“¨ ÐŸÐµÑ€ÐµÑÑ‹Ð»ÐºÐ°", callback_data="btn_forward")
    )
    return kb

def build_day_text(chat_id):
    store = get_chat_store(chat_id)
    today = get_today_key()
    recs = store.get("daily_records", {}).get(today, [])
    text = f"ðŸ“… {today}\n"
    if not recs:
        text += "ÐÐµÑ‚ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð·Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ.\n"
    else:
        for r in recs:
            sign = "âž•" if r["amount"] > 0 else "âž–"
            text += f"{r['id']}. {sign}{abs(r['amount'])} â€” {r['note']}\n"
    text += f"\nðŸ’° ÐžÐ±Ñ‰Ð¸Ð¹ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº: {store['balance']} ARS"
    return text

def update_or_send_today_window(chat_id, extra_text=None):
    kb = build_main_keyboard(chat_id)
    text = build_day_text(chat_id)
    if extra_text:
        text += f"\n\n{extra_text}"
    try:
        bot.edit_message_text(text, chat_id, data["chats"][str(chat_id)].get("last_msg_id"), reply_markup=kb)
    except:
        msg = bot.send_message(chat_id, text, reply_markup=kb)
        data["chats"][str(chat_id)]["last_msg_id"] = msg.message_id
        save_data(data)

# === ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ ===

@bot.message_handler(commands=["start"])
def start_command(msg):
    chat_id = msg.chat.id
    text = (
        "ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð­Ñ‚Ð¾ Ñ‚Ð²Ð¾Ð¹ Ð±Ð¾Ñ‚ ÑƒÑ‡Ñ‘Ñ‚Ð°.\n\n"
        "ðŸ“Œ ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÑŒ ÑÑƒÐ¼Ð¼Ñƒ:\n"
        "â€¢ `+100` Ð¸Ð»Ð¸ `100` â€” Ð¿Ñ€Ð¸Ñ…Ð¾Ð´\n"
        "â€¢ `-50` â€” Ñ€Ð°ÑÑ…Ð¾Ð´\n\n"
        "ÐœÐ¾Ð¶Ð½Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ñ€Ð¾Ðº ÑÑ€Ð°Ð·Ñƒ.\n\n"
        "ðŸ“Š Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð½Ð¸Ð¶Ðµ Ð´Ð»Ñ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð¾Ð² Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ."
    )
    update_or_send_today_window(chat_id, extra_text=text)

# -----------------------------
# 9. ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð²Ñ…Ð¾Ð´ÑÑ‰Ð¸Ñ… ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
# -----------------------------
@bot.message_handler(func=lambda m: True)
def handle_message(msg):
    chat_id = msg.chat.id
    text = msg.text or ""
    store = get_chat_store(chat_id)

    # --- ÐŸÐµÑ€ÐµÑÑ‹Ð»ÐºÐ° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†ÐµÐ¼ ---
    if chat_id == OWNER_ID and msg.chat.type == "private":
        target_chat_id = store.get("forward_target")
        if target_chat_id:
            try:
                bot.send_message(target_chat_id, text)
            except:
                update_or_send_today_window(chat_id, extra_text="âŒ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿ÐµÑ€ÐµÑÐ»Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ")
            store["forward_target"] = None
        update_or_send_today_window(chat_id)
        return

    # --- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ Ð´Ñ€ÑƒÐ³Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ, Ð¿ÐµÑ€ÐµÑÑ‹Ð»ÐºÐ° Ð² Ð»Ð¸Ñ‡ÐºÑƒ Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†Ð° ---
    if chat_id != OWNER_ID and OWNER_ID:
        try:
            bot.send_message(OWNER_ID, f"Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ {msg.from_user.first_name} ({chat_id}):\n{text}")
        except:
            log_error(f"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿ÐµÑ€ÐµÑÐ»Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†Ñƒ: {chat_id}")

    # --- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ---
    wait_action = store.get("edit_wait")

    # === ÐžÐ±Ñ‹Ñ‡Ð½Ð¾Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ ===
    if wait_action is None:
        lines = text.splitlines()
        any_added = False

        for line in lines:
            clean_line = re.sub(r"[^\d\+\-]", "", line)
            match = re.match(r"([+-]?\d+)", clean_line)
            if not match:
                continue
            try:
                amount = int(match.group(1))
                note = line[match.end():].strip()
                add_record_to_chat(chat_id, amount, note, msg.from_user.id)
                any_added = True
            except Exception as e:
                log_error(f"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ð¸ Ð·Ð°Ð¿Ð¸ÑÐ¸: {e}")
                continue

        if any_added:
            update_or_send_today_window(chat_id, extra_text="âœ… Ð—Ð°Ð¿Ð¸ÑÐ¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹")
        else:
            update_or_send_today_window(chat_id)
        return

    # === Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸ ===
    if wait_action == "change_id":
        try:
            rid = int(text.strip())
            store["edit_wait"] = "change_value"
            store["edit_target"] = rid
            update_or_send_today_window(chat_id, extra_text=f"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð¾Ð²ÑƒÑŽ ÑÑƒÐ¼Ð¼Ñƒ Ð¸ Ð·Ð°Ð¼ÐµÑ‚ÐºÑƒ Ð´Ð»Ñ Ð·Ð°Ð¿Ð¸ÑÐ¸ {rid}:")
        except:
            update_or_send_today_window(chat_id, extra_text="âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ID. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.")
        return

    elif wait_action == "change_value":
        rid = store.get("edit_target")
        if not rid:
            store["edit_wait"] = None
            return
        parts = text.strip().split(" ", 1)
        try:
            amount = int(parts[0])
            note = parts[1] if len(parts) > 1 else ""
            success, _ = update_record_in_chat(chat_id, rid, amount, note)
            if success:
                update_or_send_today_window(chat_id, extra_text=f"âœ… Ð—Ð°Ð¿Ð¸ÑÑŒ {rid} Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð°")
            else:
                update_or_send_today_window(chat_id, extra_text=f"âŒ Ð—Ð°Ð¿Ð¸ÑÑŒ {rid} Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°")
        except:
            update_or_send_today_window(chat_id, extra_text="âŒ ÐÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ Ð²Ð²Ð¾Ð´. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.")
        store["edit_wait"] = None
        store["edit_target"] = None
        return

    # === Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸ ===
    if wait_action == "delete_id":
        try:
            rid = int(text.strip())
            success, _ = delete_record_in_chat(chat_id, rid)
            if success:
                update_or_send_today_window(chat_id, extra_text=f"âœ… Ð—Ð°Ð¿Ð¸ÑÑŒ {rid} ÑƒÐ´Ð°Ð»ÐµÐ½Ð°")
            else:
                update_or_send_today_window(chat_id, extra_text=f"âŒ Ð—Ð°Ð¿Ð¸ÑÑŒ {rid} Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°")
        except:
            update_or_send_today_window(chat_id, extra_text="âŒ ÐÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ ID. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.")
        store["edit_wait"] = None
        return

    # === ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿ÐµÑ€ÐµÑÑ‹Ð»ÐºÐ¸ ===
    if wait_action == "set_forward_target":
        try:
            target_chat_id = int(text.strip())
            store["forward_target"] = target_chat_id
            store["edit_wait"] = None
            update_or_send_today_window(chat_id, extra_text=f"âœ… Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¸Ð· Ð²Ð°ÑˆÐµÐ¹ Ð»Ð¸Ñ‡ÐºÐ¸ Ð±ÑƒÐ´ÑƒÑ‚ Ð¿ÐµÑ€ÐµÑÑ‹Ð»Ð°Ñ‚ÑŒÑÑ Ð² Ñ‡Ð°Ñ‚ {target_chat_id}")
        except:
            update_or_send_today_window(chat_id, extra_text="âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ID Ñ‡Ð°Ñ‚Ð°. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.")
        return

# -----------------------------
# 10. ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ½Ð¾Ð¿Ð¾Ðº
# -----------------------------
@bot.callback_query_handler(func=lambda call: True)
def handle_buttons(call):
    chat_id = call.message.chat.id
    data_id = call.data
    store = get_chat_store(chat_id)

    # --- ÐžÑ‚Ñ‡Ñ‘Ñ‚ ---
    if data_id == "btn_report":
        today_key = get_today_key()
        day_records = store.get("daily_records", {}).get(today_key, [])
        
        income = sum(r["amount"] for r in day_records if r["amount"] > 0)
        expense = abs(sum(r["amount"] for r in day_records if r["amount"] < 0))
        overall_balance = store.get("balance", 0)

        text = (
            f"ðŸ“… {today_key}\n"
            f"ðŸ“Š ÐžÑ‚Ñ‡Ñ‘Ñ‚ Ð·Ð° Ð´ÐµÐ½ÑŒ:\n\n"
            f"âž• ÐŸÑ€Ð¸Ñ…Ð¾Ð´ Ð´Ð½Ñ: {income} ARS\n"
            f"âž– Ð Ð°ÑÑ…Ð¾Ð´ Ð´Ð½Ñ: {expense} ARS\n\n"
            f"ðŸ’° ÐžÐ±Ñ‰Ð¸Ð¹ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº: {overall_balance} ARS"
        )
        
        kb = build_main_keyboard(chat_id)
        try:
            bot.edit_message_text(text, chat_id, call.message.message_id, reply_markup=kb)
        except Exception as e:
            log_error(f"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¸ Ð¾ÐºÐ½Ð° Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð°: {e}")
        return

    # --- Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð² Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ ---
    elif data_id in ["btn_start", "cancel_reset"]:
        update_or_send_today_window(chat_id)
        return

    # --- Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ---
    elif data_id == "btn_edit":
        kb = types.InlineKeyboardMarkup(row_width=2)
        kb.add(
            types.InlineKeyboardButton("âœï¸", callback_data="edit_change"),
            types.InlineKeyboardButton("âŒ", callback_data="edit_delete"),
        )
        kb.add(types.InlineKeyboardButton("ðŸ”™", callback_data="btn_start"))
        update_or_send_today_window(chat_id, extra_text="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð´Ð»Ñ Ð·Ð°Ð¿Ð¸ÑÐ¸:")
        bot.edit_message_reply_markup(chat_id, call.message.message_id, reply_markup=kb)
        return

    # --- Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ ---
    elif data_id == "edit_change":
        store["edit_wait"] = "change_id"
        update_or_send_today_window(chat_id, extra_text="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ID Ð·Ð°Ð¿Ð¸ÑÐ¸, ÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ:")
        return

    # --- Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ ---
    elif data_id == "edit_delete":
        store["edit_wait"] = "delete_id"
        update_or_send_today_window(chat_id, extra_text="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ID Ð·Ð°Ð¿Ð¸ÑÐ¸, ÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ:")
        return

    # --- ÐžÐ±Ð½ÑƒÐ»Ð¸Ñ‚ÑŒ (Ñ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸ÐµÐ¼) ---
    elif data_id == "btn_reset":
        kb = build_main_keyboard(chat_id, confirm_reset=True)
        bot.edit_message_text("âš ï¸ Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð’Ð¡Ð• Ð´Ð°Ð½Ð½Ñ‹Ðµ?", chat_id, call.message.message_id, reply_markup=kb)
        return

    # --- ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ ÑÐ±Ñ€Ð¾ÑÐ° ---
    elif data_id == "confirm_reset":
        global data
        data = default_data()
        save_data(data)
        update_or_send_today_window(chat_id, extra_text="âœ… Ð’ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ð±Ð½ÑƒÐ»ÐµÐ½Ñ‹")
        return

    # --- Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ CSV ---
    elif data_id == "export_csv":
        try:
            export_to_csv(data)
            with open(CSV_FILE, "rb") as f:
                bot.send_document(chat_id, f, caption="ðŸ“„ Ð’Ð°Ñˆ CSV-Ñ„Ð°Ð¹Ð»")
        except:
            update_or_send_today_window(chat_id, extra_text="âŒ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ CSV.")
        return

    # --- ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿ÐµÑ€ÐµÑÑ‹Ð»ÐºÐ¸ ---
    elif data_id == "btn_forward":
        store["edit_wait"] = "set_forward_target"
        update_or_send_today_window(chat_id, extra_text="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ID Ñ‡Ð°Ñ‚Ð°, ÐºÑƒÐ´Ð° Ð¿ÐµÑ€ÐµÑÑ‹Ð»Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¸Ð· Ð²Ð°ÑˆÐµÐ¹ Ð»Ð¸Ñ‡ÐºÐ¸:")
        return

    elif data_id in ["btn_cod", "noop"]:
        bot.answer_callback_query(call.id)
        return

# === Ð—Ð°Ð¿ÑƒÑÐº ===
print("âœ… Ð‘Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½")
bot.infinity_polling(skip_pending=True)