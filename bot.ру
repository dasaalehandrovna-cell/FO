import telebot
import threading
from flask import Flask

# üîë –¢–≤–æ–π —Ç–æ–∫–µ–Ω
TOKEN = "8475002362:AAEICuxcrZhnltpSBHxH74nw6efZ0T-4RZ0"

bot = telebot.TeleBot(TOKEN)
app = Flask(__name__)

# üßÆ –ü–∞–º—è—Ç—å –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞
balance = 0
records = []

@app.route('/')
def home():
    return "–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ"

@bot.message_handler(commands=['start'])
def start_message(message):
    bot.send_message(
        message.chat.id,
        "üëã –ü—Ä–∏–≤–µ—Ç! –Ø –≤–µ–¥—É —Ç–≤–æ–π –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –û—Ç—á—ë—Ç (–§–û).\n\n"
        "–û—Ç–ø—Ä–∞–≤–ª—è–π –º–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n"
        "`+1000 —Ö–ª–µ–±` ‚Äî –ø—Ä–∏—Ö–æ–¥\n"
        "`-500 –±–µ–Ω–∑–∏–Ω` ‚Äî —Ä–∞—Å—Ö–æ–¥\n\n"
        "–ö–æ–º–∞–Ω–¥—ã:\n"
        "/–±–∞–ª–∞–Ω—Å ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫\n"
        "/–æ—Ç—á–µ—Ç ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",
        parse_mode="Markdown"
    )

@bot.message_handler(commands=['–±–∞–ª–∞–Ω—Å'])
def show_balance(message):
    bot.send_message(message.chat.id, f"üí∞ –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: {balance}")

@bot.message_handler(commands=['–æ—Ç—á–µ—Ç'])
def show_report(message):
    if not records:
        bot.send_message(message.chat.id, "üìÇ –û—Ç—á—ë—Ç –ø—É—Å—Ç.")
    else:
        text = "\n".join(records)
        bot.send_message(message.chat.id, f"üìò –¢–µ–∫—É—â–∏–π –æ—Ç—á—ë—Ç:\n\n{text}\n\nüí∞ –ë–∞–ª–∞–Ω—Å: {balance}")

@bot.message_handler(func=lambda message: True)
def handle_transaction(message):
    global balance

    text = message.text.strip()
    if text.startswith('+') or text.startswith('-'):
        try:
            parts = text.split(' ', 1)
            amount = int(parts[0])
            comment = parts[1] if len(parts) > 1 else ''
            balance += amount
            record = f"{'–ü—Ä–∏—Ö–æ–¥' if amount > 0 else '–†–∞—Å—Ö–æ–¥'} {amount}: {comment}"
            records.append(record)
            bot.send_message(message.chat.id, f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: {record}\nüí∞ –ë–∞–ª–∞–Ω—Å: {balance}")
        except Exception:
            bot.send_message(message.chat.id, "‚ö†Ô∏è –û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞. –ü—Ä–∏–º–µ—Ä: `+1000 —Ö–ª–µ–±`", parse_mode="Markdown")
    else:
        bot.send_message(message.chat.id, "üìé –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π `+` –∏–ª–∏ `-` –ø–µ—Ä–µ–¥ —Å—É–º–º–æ–π.", parse_mode="Markdown")

def run_bot():
    bot.polling(none_stop=True)

if __name__ == "__main__":
    threading.Thread(target=run_bot).start()
    app.run(host="0.0.0.0", port=10000)
